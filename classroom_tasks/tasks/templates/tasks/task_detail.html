{% extends "base.html" %}  {# Usamos la plantilla base #}
{% load static %}

{% block title %}Detalle de tarea{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/styles.css' %}">  {# CSS #}

<div class="task-detail">
    <h2 class="task-title">{{ task.title }}</h2>  {# TÃ­tulo de la tarea #}

    <div class="task-meta">
        <p><strong>Tipo:</strong> {{ task.get_type_display }}</p>  {# Tipo legible #}

        <p><strong>Estado:</strong>  {# Estado segÃºn flags #}
            {% if task.is_pending %}ğŸŸ¡ Pendiente{% endif %}
            {% if task.is_delivered %}ğŸ”µ Entregada{% endif %}
            {% if task.is_validated %}âœ… Validada{% endif %}
        </p>

        <p><strong>Fecha lÃ­mite:</strong> {{ task.due_date|date:"d/m/Y H:i" }}</p>  {# Fecha lÃ­mite #}
        <p><strong>Fecha de creaciÃ³n:</strong> {{ task.created_at|date:"d/m/Y H:i" }}</p>  {# Fecha creaciÃ³n #}
    </div>

    <div class="task-description">
        <h3>DescripciÃ³n</h3>
        <p>{{ task.description|default:"Sin descripciÃ³n" }}</p>  {# DescripciÃ³n o texto por defecto #}
    </div>

    <div class="task-people">
        <h3>Participantes</h3>

        <p><strong>Creador:</strong> {{ task.creator.username }}</p>  {# Usuario creador #}

        <p><strong>Miembros:</strong>  {# Miembros del grupo #}
            {% for m in task.members.all %}
                {{ m.username }}{% if not forloop.last %}, {% endif %}
            {% empty %}Sin miembros{% endfor %}
        </p>

        {% if task.teacher_validator %}
            <p><strong>Validada por:</strong> {{ task.teacher_validator.username }}</p>  {# Profesor validador #}
        {% endif %}
    </div>

    <div class="task-actions">
        {% if task.status == "PENDIENTE" %}
            <a href="{% url 'tasks:deliver_task' task.id %}" class="btn">ğŸ“¤ Entregar tarea</a>  {# Entregar #}
        {% endif %}

        {% if task.status == "ENTREGADA" %}
            <a href="{% url 'tasks:cancel_delivery' task.id %}" class="btn btn-warning">âŒ Cancelar entrega</a>  {# Cancelar entrega #}
        {% endif %}

        {% if user.is_profesor and task.requires_teacher_validation and task.is_delivered %}
            <a href="{% url 'tasks:validate_task' task.id %}" class="btn">âœ” Validar</a>  {# Validar como profesor #}
        {% endif %}

        <a href="{% url 'tasks:list_my_tasks' %}" class="btn btn-secondary">â¬… Volver</a>  {# Volver al listado #}
    </div>
</div>
{% endblock %}
